<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Kosmos â€” AI Chat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: system-ui, sans-serif; background:#111; color:#eee; margin:24px; }
    .wrap { max-width:680px; margin:auto; }
    .log { border:1px solid #333; border-radius:12px; padding:12px; height:420px; overflow:auto; background:#0c0c0c; }
    .msg { margin:8px 0; padding:8px 12px; border-radius:10px; }
    .me { background:#1e3a8a; }
    .ai { background:#1f2937; }
    form { display:flex; gap:8px; margin-top:12px; }
    input,button { padding:10px 12px; border-radius:10px; border:1px solid #333; background:#151515; color:#eee; }
    button { background:#2563eb; border:none; cursor:pointer; }
  </style>
</head>
<body>
  <div class="wrap">
    <h2>ðŸ’¬ Kosmos AI</h2>
    <div id="log" class="log"></div>
    <form id="f">
      <input id="t" type="text" placeholder="Ask anythingâ€¦" style="flex:1" />
      <button>Send</button>
    </form>
  </div>

  <script type="module">
    // your Supabase function endpoint and anon key
    const FN_URL = "https://advihqhjjlxumgdlbwui.supabase.co/functions/v1/ai-chat";
    const SUPABASE_ANON =
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFkdmlocWhqamx4dW1nZGxid3VpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEwMTg0MzIsImV4cCI6MjA3NjU5NDQzMn0.kVlaPQg2_o9DGJYv22Dgca7veok4drF6kgLPy2wPBeY";

    const headers = {
      "Authorization": `Bearer ${SUPABASE_ANON}`,
      "Content-Type": "application/json",
    };

    const log = document.getElementById("log");
    const f = document.getElementById("f");
    const t = document.getElementById("t");

    const push = (text, cls) => {
      const div = document.createElement("div");
      div.className = `msg ${cls}`;
      div.textContent = text;
      log.appendChild(div);
      log.scrollTop = log.scrollHeight;
    };

    f.addEventListener("submit", async (e) => {
      e.preventDefault();
      const q = t.value.trim();
      if (!q) return;
      t.value = "";
      push(q, "me");

      const body = { messages: [{ role: "user", content: q }] };
      try {
        const r = await fetch(FN_URL, { method:"POST", headers, body: JSON.stringify(body) });
        const j = await r.json();
        if (j?.ok) push(j.reply || "(no reply)", "ai");
        else push(`Error: ${j?.error || r.status}`, "ai");
      } catch (err) {
        push(`Network error: ${err}`, "ai");
      }
    });
  </script>
</body>
</html>
